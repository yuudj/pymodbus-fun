# Telegraf Configuration
#
# Telegraf is entirely plugin driven. All metrics are gathered from the
# declared inputs, and sent to the declared outputs.
#
# Plugins must be declared in here to be active.
# To deactivate a plugin, comment out the name and any variables.
#
# Use 'telegraf -config telegraf.conf -test' to see what metrics a config
# file would generate.
#
# Environment variables can be used anywhere in this config file, simply prepend
# them with $. For strings the variable must be within quotes (ie, "$STR_VAR"),
# for numbers and booleans they should be plain (ie, $INT_VAR, $BOOL_VAR)


# Global tags can be specified here in key="value" format.
[global_tags]
  # dc = "us-east-1" # will tag all metrics with dc=us-east-1
  # rack = "1a"
  ## Environment variables can be used as tags, and throughout the config file
  # user = "$USER"


# Configuration for telegraf agent
[agent]
  interval = "5s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "5s"
  flush_jitter = "0s"
  precision = ""
  debug = false
  quiet = false
  logfile = ""
  hostname = "$HOSTNAME"
  omit_hostname = false

###############################################################################
#                            OUTPUT PLUGINS                                   #
###############################################################################
# # Configuration for sending metrics to InfluxDB
 [[outputs.influxdb_v2]]
#   ## The URLs of the InfluxDB cluster nodes.
#   ##
#   ## Multiple URLs can be specified for a single cluster, only ONE of the
#   ## urls will be written to each interval.
#   ##   ex: urls = ["https://us-west-2-1.aws.cloud2.influxdata.com"]
   urls = ["http://influxdb:8086"]
#
#   ## Token for authentication.
   token = "${INFLUXDB_INIT_ADMIN_TOKEN}"
#
#   ## Organization is the name of the organization you wish to write to; must exist.
   organization = "${INFLUXDB_INIT_ORG}"
#
#   ## Destination bucket to write into.
   bucket = "${INFLUXDB_INIT_BUCKET}"

###############################################################################
#                            INPUT PLUGINS                                    #
###############################################################################
[[inputs.modbus]]
name = "energymeter"
slave_id = 11
timeout = "1s"
busy_retries = 2
busy_retries_wait = "1s"
controller = "file:///dev/ttyUSB1"
baud_rate = 9600
data_bits = 8
parity = "E"
stop_bits = 1
transmission_mode = "RTU"
input_registers = [
    { measurement = "voltage_phase_a", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [6,7]}
   #{ measurement = "voltage_phase_a", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [0,1]}{ measurement = "voltage_phase_b", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [2,3]},{ measurement = "voltage_phase_c", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [4,5]},{ measurement = "current_phase_a", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [8,9]},{ measurement = "current_phase_b", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [10,11]},{ measurement = "current_phase_c", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [12,13]},{ measurement = "power_active_total", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [16,17]},{ measurement = "power_active_a", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [18,19]},{ measurement = "power_active_b", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [20,21]},{ measurement = "power_active_c", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [22,23]},{ measurement = "power_reactive_total", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [24,25]},{ measurement = "power_reactive_a", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [26,27]},{ measurement = "power_reactive_b", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [28,29]},{ measurement = "power_reactive_c", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [30,31]},{ measurement = "power_factor_a", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [42,43]},{ measurement = "power_factor_b", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [44,45]},{ measurement = "power_factor_c", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [46,47]},{ measurement = "frequency", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [54,55]},{ measurement = "energy_active_total", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [256,257]},{ measurement = "energy_reactive_total", name = "value", byte_order = "ABCD", data_type = "FLOAT32-IEEE", scale=1.0, address = [1024,1025]},
]